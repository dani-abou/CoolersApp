{"ast":null,"code":"var _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"@babel/runtime/helpers/asyncToGenerator\");\n\nrequire('isomorphic-fetch');\n\nvar dotenv = require('dotenv');\n\nvar Koa = require('koa');\n\nvar next = require('next');\n\nvar _require = require('@shopify/koa-shopify-auth'),\n    createShopifyAuth = _require[\"default\"];\n\nvar _require2 = require('@shopify/koa-shopify-auth'),\n    verifyRequest = _require2.verifyRequest;\n\nvar session = require('koa-session');\n\ndotenv.config();\n\nvar _require3 = require('@shopify/koa-shopify-graphql-proxy'),\n    graphQLProxy = _require3[\"default\"];\n\nvar _require4 = require('@shopify/koa-shopify-graphql-proxy'),\n    ApiVersion = _require4.ApiVersion;\n\nvar port = parseInt(process.env.PORT, 10) || 3000;\nvar dev = true;\nvar app = next({\n  dev: dev\n});\nvar handle = app.getRequestHandler(); //import {createShopifyMiddleware} from \"./auth\";\n\nvar SHOPIFY_API_SECRET_KEY = process.env.SHOPIFY_API_SECRET_KEY;\nvar SHOPIFY_API_KEY = process.env.SHOPIFY_API_KEY;\nvar HOST = process.env.HOST;\napp.prepare().then(function () {\n  var server = new Koa();\n  server.use(session({\n    secure: true,\n    sameSite: 'none'\n  }, server));\n  server.keys = [SHOPIFY_API_SECRET_KEY];\n  server.use(createShopifyAuth({\n    apiKey: SHOPIFY_API_KEY,\n    secret: SHOPIFY_API_SECRET_KEY,\n    scopes: ['read_products', 'write_products', 'read_script_tags', 'write_script_tags'],\n    afterAuth: function afterAuth(ctx) {\n      var _ctx$session = ctx.session,\n          shop = _ctx$session.shop,\n          accessToken = _ctx$session.accessToken;\n      ctx.cookies.set('shopOrigin', shop, {\n        httpOnly: false\n      });\n      ctx.redirect('/');\n    }\n  }));\n  server.use(graphQLProxy({\n    version: ApiVersion.October19\n  }));\n  server.use(verifyRequest());\n  server.use( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return handle(ctx.req, ctx.res);\n\n            case 2:\n              ctx.respond = false;\n              ctx.res.statusCode = 200;\n              return _context.abrupt(\"return\");\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n  server.use(createShopifyMiddleware(HOST, db, {\n    apiKey: SHOPIFY_API_KEY,\n    secret: SHOPIFY_API_SECRET_KEY\n  }));\n  server.listen(port, function () {\n    console.log(\"> Ready on http://localhost:\".concat(port));\n  });\n});","map":{"version":3,"sources":["C:/Users/abouh/OneDrive/Desktop/sampleApp/server.js"],"names":["require","dotenv","Koa","next","createShopifyAuth","verifyRequest","session","config","graphQLProxy","ApiVersion","port","parseInt","process","env","PORT","dev","app","handle","getRequestHandler","SHOPIFY_API_SECRET_KEY","SHOPIFY_API_KEY","HOST","prepare","then","server","use","secure","sameSite","keys","apiKey","secret","scopes","afterAuth","ctx","shop","accessToken","cookies","set","httpOnly","redirect","version","October19","req","res","respond","statusCode","createShopifyMiddleware","db","listen","console","log"],"mappings":"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","sourcesContent":["require('isomorphic-fetch');\r\nconst dotenv = require('dotenv');\r\nconst Koa = require('koa');\r\nconst next = require('next');\r\nconst { default: createShopifyAuth } = require('@shopify/koa-shopify-auth');\r\nconst { verifyRequest } = require('@shopify/koa-shopify-auth');\r\nconst session = require('koa-session');\r\n\r\ndotenv.config();\r\nconst { default: graphQLProxy } = require('@shopify/koa-shopify-graphql-proxy');\r\nconst { ApiVersion } = require('@shopify/koa-shopify-graphql-proxy')\r\n\r\nconst port = parseInt(process.env.PORT, 10) || 3000;\r\nconst dev = process.env.NODE_ENV !== 'production';\r\nconst app = next({ dev });\r\nconst handle = app.getRequestHandler();\r\n//import {createShopifyMiddleware} from \"./auth\";\r\n\r\nconst SHOPIFY_API_SECRET_KEY = process.env.SHOPIFY_API_SECRET_KEY\r\nconst SHOPIFY_API_KEY = process.env.SHOPIFY_API_KEY\r\nconst HOST = process.env.HOST;\r\n\r\n\r\napp.prepare().then(() => {\r\n  const server = new Koa();\r\n  server.use(session({ secure: true, sameSite: 'none' }, server));\r\n  server.keys = [SHOPIFY_API_SECRET_KEY];\r\n  server.use(\r\n    createShopifyAuth({\r\n      apiKey: SHOPIFY_API_KEY,\r\n      secret: SHOPIFY_API_SECRET_KEY,\r\n      scopes: [\r\n        'read_products',\r\n        'write_products',\r\n        'read_script_tags',\r\n        'write_script_tags'\r\n      ],\r\n      afterAuth(ctx) {\r\n        const { shop, accessToken } = ctx.session;\r\n        ctx.cookies.set('shopOrigin', shop, {\r\n          httpOnly: false,\r\n        })\r\n\r\n        ctx.redirect('/');\r\n      },\r\n    }),\r\n  );\r\n\r\n  server.use(graphQLProxy({version: ApiVersion.October19}))\r\n\r\n  server.use(verifyRequest());\r\n  server.use(async (ctx) => {\r\n    await handle(ctx.req, ctx.res);\r\n    ctx.respond = false;\r\n    ctx.res.statusCode = 200;\r\n    return\r\n  });\r\n\r\n  server.use(createShopifyMiddleware(HOST, db, {\r\n      apiKey: SHOPIFY_API_KEY,\r\n      secret: SHOPIFY_API_SECRET_KEY\r\n  }));\r\n\r\n  server.listen(port, () => {\r\n    console.log(`> Ready on http://localhost:${port}`)\r\n  })\r\n})\r\n"]},"metadata":{},"sourceType":"script"}